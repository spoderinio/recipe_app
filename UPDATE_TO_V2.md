# 🚀 ОБНОВЯВАНЕ КЪМ V2.0 - КАТЕГОРИИ

## 🎉 Нови функции във версия 2.0:

### ✨ Добавени:
1. **📂 Категории за рецепти** - групиране на рецепти (Супи, Салати, Основни ястия, и т.н.)
2. **🗂️ Управление на категории** - преименуване и изтриване от админ панела
3. **🔍 Case-insensitive търсене** - "пилешка" = "Пилешка"
4. **📱 Подобрен UI** - карти за категории на началната страница

### 🐛 Поправени:
- Търсенето вече не различава главни/малки букви

---

## 📥 ИНСТРУКЦИИ ЗА ОБНОВЯВАНЕ

### За НОВА инсталация (няма стара база данни):
```bash
cd ~/Projects/recipe_app

# Обновяване на файловете (copy новите версии)

# Създаване на нова база данни с категории
python3 add_sample_recipes.py

# Рестартиране
sudo systemctl restart recipe_app
```

---

### За СЪЩЕСТВУВАЩА инсталация (имаш стари рецепти):

#### Стъпка 1: Backup на старата база данни
```bash
cd ~/Projects/recipe_app
cp recipes.db recipes_backup_$(date +%Y%m%d).db
```

#### Стъпка 2: Обновяване на файловете
```bash
# Копирай новите версии на файловете:
# - app.py
# - database.py
# - add_sample_recipes.py
# - migrate_to_categories.py (нов)
# - templates/index.html
# - templates/recipe.html
# - templates/admin.html
# - templates/category.html (нов)
# - templates/admin_categories.html (нов)
# - static/css/style.css
# - static/js/app.js
```

#### Стъпка 3: Миграция на базата данни
```bash
python3 migrate_to_categories.py
```

Този скрипт:
- ✅ Добавя `category` колона към съществуващата таблица
- ✅ Всички стари рецепти получават категория "Други"
- ✅ Не изтрива никакви данни

#### Стъпка 4: Рестартиране на приложението
```bash
sudo systemctl restart recipe_app
sudo systemctl status recipe_app
```

#### Стъпка 5: Проверка
```bash
# Отвори в браузър
# http://[IP]:5002
```

Трябва да видиш:
- ✅ Главната страница показва категории
- ✅ Старите рецепти са в категория "Други"
- ✅ Можеш да редактираш и да им зададеш правилна категория

---

## 📝 КАКВО СЕ ПРОМЕНИ

### Database (database.py):
- ✅ Добавена `category` колона (по подразбиране "Други")
- ✅ `migrate_add_category()` функция за миграция
- ✅ `get_all_categories()` - връща категории с брой рецепти
- ✅ `get_recipes_by_category()` - рецепти от категория
- ✅ `rename_category()` - преименуване
- ✅ `delete_category()` - изтриване (премества в "Други")
- ✅ **COLLATE NOCASE** в SQL заявките за case-insensitive търсене

### Backend (app.py):
- ✅ Нов route: `/category/<name>` - показва рецепти от категория
- ✅ Нов route: `/admin/categories` - управление на категории
- ✅ Нови API endpoints за категории
- ✅ Всички recipe endpoints включват `category`

### Frontend (templates/):
- ✅ **index.html** - показва категории вместо рецепти
- ✅ **category.html** (НОВ) - рецепти от избрана категория
- ✅ **recipe.html** - показва badge с категорията
- ✅ **admin.html** - dropdown за избор на категория
- ✅ **admin_categories.html** (НОВ) - управление на категории

### Styles (style.css):
- ✅ Стилове за category cards
- ✅ Стилове за category badge
- ✅ Стилове за админ панел с категории
- ✅ Modal за редактиране
- ✅ Mobile responsive adjustments

### JavaScript (app.js):
- ✅ `searchRecipesGlobal()` - глобално търсене
- ✅ `searchInCategory()` - търсене в категория
- ✅ `handleCategorySelect()` - управление на category dropdown
- ✅ `editCategory()`, `deleteCategory()` - управление на категории
- ✅ Обновени `submitRecipe()` и `editRecipe()` за категория

---

## 🎨 КАК РАБОТИ

### Начална страница:
```
┌────────────────────────────────┐
│  📖 Книга с рецепти            │
│  🔍 [Търсене...]               │
├────────────────────────────────┤
│  📂 Супи        (3)            │
│  📂 Салати      (1)            │
│  📂 Основни     (2)            │
│  📂 Закуски     (1)            │
│  📂 Други       (5)            │
└────────────────────────────────┘
```

### Кликваш категория:
```
┌────────────────────────────────┐
│  📂 Супи (3 рецепти)           │
│  🔍 [Търси в Супи...]          │
├────────────────────────────────┤
│  🍲 Пилешка супа               │
│  🍲 Таратор                     │
│  🍲 Боб чорба                   │
└────────────────────────────────┘
```

### Админ панел:
```
┌────────────────────────────────┐
│  [📖 Рецепти] [🗂️ Категории]  │
└────────────────────────────────┘

При добавяне на рецепта:
  Категория: [Dropdown: Супи ▼]
  Или:       [Нова категория...]
```

### Управление на категории:
```
┌────────────────────────────────┐
│  📂 Супи (5 рецепти)           │
│     [✏️ Преименувай] [🗑️ Изтрий] │
└────────────────────────────────┘

📂 Други (1 рецепта) 🔒
   (Системна - не може да се изтрие)
```

---

## ❓ ЧЕСТО ЗАДАВАНИ ВЪПРОСИ

### Какво става със старите рецепти?
- Те автоматично отиват в категория "Други"
- Можеш да ги редактираш и да им зададеш правилна категория

### Мога ли да върна старата версия?
- Да! Имаш backup: `recipes_backup_YYYYMMDD.db`
- Копирай стария файл обратно и рестартирай

### Какво ако изтрия категория с рецепти?
- Рецептите автоматично се преместват в "Други"
- Не се губят данни

### Мога ли да преименувам "Други"?
- Не, това е защитена системна категория
- Служи като "catch-all" за некатегоризирани рецепти

### Case-sensitive търсене оправено ли е?
- Да! Сега "пилешка" = "Пилешка" = "ПИЛЕШКА"

---

## 🧪 ТЕСТВАНЕ СЛЕД ОБНОВЯВАНЕ

### Checklist:
- [ ] Главната страница показва категории
- [ ] Кликване на категория показва рецепти
- [ ] Търсенето работи (case-insensitive)
- [ ] Старите рецепти са в "Други"
- [ ] Може да добавя нова рецепта с категория
- [ ] Може да редактирам рецепта и да сменя категорията
- [ ] Админ → Категории работи
- [ ] Може да преименувам категория
- [ ] Може да изтрия празна категория
- [ ] "Други" не може да се изтрие (защитена)

---

## 🔄 ROLLBACK (Връщане към стара версия)

Ако нещо не работи:

```bash
cd ~/Projects/recipe_app

# Спри услугата
sudo systemctl stop recipe_app

# Върни стария backup
cp recipes_backup_YYYYMMDD.db recipes.db

# Върни старите файлове (от Git или backup)
# ...

# Стартирай отново
sudo systemctl start recipe_app
```

---

## 📞 ПОМОЩ

### Проблеми след миграцията?

**Грешка при миграция:**
```bash
# Провери логовете
python3 migrate_to_categories.py
```

**Приложението не стартира:**
```bash
sudo journalctl -u recipe_app -n 50
```

**Липсват категории:**
```bash
# Презареди страницата
# Ctrl + F5 (force refresh)
```

---

## 🎉 ГОТОВО!

След успешна миграция имаш:
- ✅ Категории за по-добра организация
- ✅ Case-insensitive търсене
- ✅ Подобрен UI
- ✅ Управление на категории
- ✅ Всички стари данни запазени

**Приятна работа с новата версия! 🚀**

---

*Последна актуализация: Януари 2026*
*Recipe App v2.0 - Categories Update*
